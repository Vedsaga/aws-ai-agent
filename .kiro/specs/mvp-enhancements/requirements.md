# Requirements Document

## Introduction

This document defines enhancements to the Multi-Agent Orchestration System to meet MVP requirements for hackathon submission within 24 hours. The backend APIs are already deployed and functional. The focus is on completing the frontend UI with dark mode, domain selection, data table view, error handling, and ensuring the civic complaint use case works end-to-end.

## Glossary

- **System**: The Multi-Agent Orchestration System
- **User**: A citizen or administrator interacting with the System
- **Domain**: A use case configuration (e.g., Civic Complaints) with ingestion and query agents
- **Ingestion Agent**: An Agent that extracts structured data from unstructured input (max 5 keys)
- **Query Agent**: An Agent that analyzes data from an interrogative perspective
- **Shadcn UI**: A component library for React with built-in dark mode support
- **Mapbox Dark Mode**: A dark-themed map style for Mapbox GL JS
- **Error Toast**: A user-visible notification displaying error messages
- **Data Table**: A tabulated view of all incidents with structured data extracted by agents

## Requirements

### Requirement 1: Dark Mode UI Implementation

**User Story:** As a User, I want a dark-themed interface with dark map visualization, so that the application is visually consistent and comfortable to use.

#### Acceptance Criteria

1. THE System SHALL use Shadcn UI components with dark mode as the default theme
2. THE System SHALL configure Mapbox to use the dark-v11 style for map visualization
3. THE System SHALL apply dark theme to all pages: login, dashboard, and configuration
4. THE System SHALL ensure text contrast meets accessibility standards in dark mode
5. THE System SHALL maintain consistent dark styling across all UI components including forms, buttons, and panels

### Requirement 2: User-Visible Error Handling

**User Story:** As a User, I want to see clear error messages when operations fail, so that I understand what went wrong and can take corrective action.

#### Acceptance Criteria

1. WHEN an API request fails, THE System SHALL display an error toast notification with the error message
2. THE System SHALL show validation errors inline on form fields before submission
3. WHEN agent execution fails, THE System SHALL display the failure reason in the real-time status panel
4. THE System SHALL provide user-friendly error messages instead of technical error codes
5. THE System SHALL include a retry action for failed operations where applicable

### Requirement 3: Domain Selection and Management

**User Story:** As a User, I want to select a domain before submitting reports or queries, so that the System processes my input with the correct agents.

#### Acceptance Criteria

1. THE System SHALL display a domain selector dropdown in the ingestion and query panels
2. THE System SHALL fetch available domains from the backend API using GET /config?type=domain_template
3. WHEN a User selects a domain, THE System SHALL store the selection and use it for subsequent submissions
4. THE System SHALL display built-in domains (Civic Complaints, Disaster Response, Agriculture) by default
5. THE System SHALL allow Users to view domain details including configured agents and their output schemas

### Requirement 4: Civic Complaint End-to-End Flow

**User Story:** As a Citizen, I want to submit a civic complaint with location and photo, see it processed by agents, and view it on the map, so that I can report issues in my community.

#### Acceptance Criteria

1. WHEN a User submits a complaint via the ingestion panel, THE System SHALL accept text input and one or more image files
2. THE System SHALL display real-time status updates showing which agents are processing the complaint
3. WHEN processing completes, THE System SHALL display the extracted structured data (max 5 keys per agent)
4. THE System SHALL add a marker to the map at the extracted location within 2 seconds of completion
5. THE System SHALL store image evidence and display it in the map popup when the marker is clicked

### Requirement 5: Query Result Map Visualization

**User Story:** As an Administrator, I want query results to update the map visualization, so that I can see spatial patterns in the analyzed data.

#### Acceptance Criteria

1. WHEN a query completes, THE System SHALL extract location data from query agent responses
2. THE System SHALL update map markers to highlight incidents matching the query criteria
3. THE System SHALL display query insights as bullet points in the chat panel
4. THE System SHALL show a summary generated by aggregating all query agent outputs
5. THE System SHALL maintain map interactivity allowing Users to click markers for detailed incident information

### Requirement 6: Data Table View for Domain Creators

**User Story:** As a Domain Creator, I want to view all incidents in a tabulated format with structured data, so that I can analyze the data extracted by agents.

#### Acceptance Criteria

1. THE System SHALL provide a data table view accessible from the dashboard
2. THE System SHALL fetch incidents using the Retrieval API (GET /data?type=retrieval)
3. THE System SHALL display columns for each field in the agent output schemas (max 5 keys per agent)
4. THE System SHALL support filtering by date range, location, category, and custom fields
5. THE System SHALL allow Users to click a row to view full incident details including images and raw text

### Requirement 7: Interactive Chat with Domain Data

**User Story:** As a Domain Creator, I want to ask questions about my domain data and get AI-generated insights, so that I can understand trends and patterns.

#### Acceptance Criteria

1. THE System SHALL provide a chat interface for domain-specific queries
2. WHEN a User asks a question, THE System SHALL submit it to the Query API (POST /query)
3. THE System SHALL display real-time status updates showing which query agents are executing
4. THE System SHALL format the response as bullet points (one per interrogative agent) followed by a summary
5. THE System SHALL maintain chat history for the current session

### Requirement 8: User Role Switching and Domain Access

**User Story:** As a User, I want to switch between using domains and managing domains I created, so that I can both submit data and configure the system.

#### Acceptance Criteria

1. THE System SHALL provide a view mode selector with two options: "Use Domain" and "Manage Domain"
2. WHEN in "Use Domain" mode, THE System SHALL display the dashboard with domain selector, map (80%), and chat (20%) for submitting reports and queries
3. WHEN in "Manage Domain" mode, THE System SHALL display domain management interface with data table view and domain configuration options
4. THE System SHALL allow any User to create new domains and use any existing domain (including their own)
5. THE System SHALL filter data table view by selected domain when in "Manage Domain" mode
